Index: app/study-requests/[...studyRequestId]/page.tsx
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>\"use client\";\n\nimport {useEffect, useState} from \"react\";\nimport axios from \"axios\";\nimport DotsLoader from \"../../../components/loading/dotLoader\";\nimport {useParams, useRouter } from \"next/navigation\";\nimport { useModel } from \"@/hooks/user-model-store\";\n\nexport default function SingleRequestPage() {\n  const { singleRequest, setSingleRequest, isLoading, setLoading } = useModel();\n  const router = useRouter();\n  const params = useParams();\n  const studyRequestId = params.studyRequestId?.[0];\n\n  const [rejectPopup, setRejectPopup] = useState<{visible: boolean, requestId: null|string}>({ visible: false, requestId: null });\n  const [acceptPopup, setAcceptPopup] = useState<{visible: boolean, requestId: null|string, phoneNumber: string}>({ visible: false, requestId: null, phoneNumber: \"\" });\n\n\n  useEffect(() => {\n    async function fetchSingleRequest() {\n      setLoading(true);\n      try {\n        const res = await axios.get(`${process.env.NEXT_PUBLIC_BACKEND_URL}/api/study-requests/${studyRequestId}`);\n        if (res.status === 200) {\n          setSingleRequest(res.data);\n        } else {\n          console.error(\"Failed to fetch request data\");\n        }\n      } catch (error) {\n        console.error(\"Error fetching request data:\", error);\n        router.push(\"/\");\n      } finally {\n        setLoading(false);\n      }\n    }\n\n    fetchSingleRequest();\n  }, [params.id, router, setLoading, setSingleRequest, studyRequestId]);\n\n  const handleAccept = async () => {\n    if (!acceptPopup.requestId || acceptPopup.phoneNumber.length !== 10 || isNaN(Number(acceptPopup.phoneNumber))) return;\n    try {\n      setLoading(true);\n      const res = await axios.patch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/api/study-requests/my-requests/accept/${studyRequestId}/${acceptPopup.requestId}`,\n        {phoneNumber: Number(acceptPopup.phoneNumber)},\n        {\n          headers: {\n            'Content-Type': 'application/json',\n          },\n        }\n      );\n      if (res.status === 200) {\n        alert(\"Request accepted successfully!\");\n        setAcceptPopup({ visible: false, requestId: null, phoneNumber: \"\" });\n        router.push(\"/study-requests/accepted-requests\");\n      }\n    } catch (error) {\n      console.error(\"Error accepting request:\", error);\n      alert(\"An error occurred while accepting the request.\");\n    } finally {\n      setLoading(false);\n    }\n\n    // const res = await axios.get(\"/api/health\");\n    // if (res.status === 200) {\n    //   alert(\"Accepted request successfully\");\n    // }\n  };\n\n  const handleReject = async () => {\n    if (!rejectPopup.requestId) return;\n    try {\n      setLoading(true);\n      const res = await axios.delete(\n        `${process.env.NEXT_PUBLIC_BACKEND_URL}/api/study-requests/my-requests/reject/${studyRequestId}/${rejectPopup.requestId}`\n      );\n      if (res.status === 200 && singleRequest) {\n        alert(\"Request rejected successfully!\");\n        setSingleRequest({\n            studyRequest: singleRequest?.studyRequest,\n            requestsToTeach: singleRequest.requestsToTeach.filter(\n              (req) => req._id.toString() !== rejectPopup.requestId\n            ),\n        });\n        setRejectPopup({ visible: false, requestId: null });\n      }\n    } catch (error) {\n      console.error(\"Error rejecting request:\", error);\n      alert(\"An error occurred while rejecting the request.\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n\n  if (isLoading || !singleRequest) {\n    return <DotsLoader />;\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-b from-gray-900 via-gray-800 to-black text-white\">\n      {/* Page Header */}\n      <div className=\"w-full py-8 bg-gray-950 shadow-lg\">\n        <h1 className=\"text-3xl font-extrabold text-blue-500 text-center\">\n          Study Request Details\n        </h1>\n      </div>\n\n      {/* Study Request Details */}\n      <div className=\"flex flex-col items-center mt-10 px-4\">\n        <div className=\"w-full max-w-5xl bg-gray-800 rounded-lg shadow-xl p-6\">\n          <h2 className=\"text-xl font-semibold text-white\">\n            {singleRequest.studyRequest.subjectName}\n          </h2>\n          <p className=\"text-sm text-gray-400 mt-2\">\n            {singleRequest.studyRequest.description}\n          </p>\n          <p className=\"text-sm text-gray-500 mt-2\">\n            Price: <span className=\"font-semibold text-white\">${singleRequest.studyRequest.price}</span>\n          </p>\n          <p className=\"text-sm text-gray-500 mt-2\">\n            Applied: <span className=\"font-semibold text-white\">{singleRequest.studyRequest.applied.length}</span>\n          </p>\n          {singleRequest.studyRequest.attachments.length > 0 && (\n            <div className=\"mt-4\">\n              <h3 className=\"text-sm text-gray-300 font-semibold\">Attachments:</h3>\n              <ul className=\"list-disc list-inside mt-2 space-y-1\">\n                {singleRequest.studyRequest.attachments.map((attachment, index) => (\n                  <li key={index}>\n                    <a\n                      href={attachment}\n                      target=\"_blank\"\n                      rel=\"noopener noreferrer\"\n                      className=\"text-blue-500 hover:underline\"\n                    >\n                      {attachment}\n                    </a>\n                  </li>\n                ))}\n              </ul>\n            </div>\n          )}\n        </div>\n\n        {/* Requests to Teach */}\n        <div className=\"w-full max-w-5xl mt-10\">\n          <h3 className=\"text-2xl font-extrabold text-blue-500 mb-6\">Requests to Teach</h3>\n          {singleRequest.requestsToTeach.length === 0 ? (\n            <div className=\"text-gray-400 text-lg\">No requests to teach found.</div>\n          ) : (\n            <div className=\"space-y-6\">\n              {singleRequest.requestsToTeach.map((request) => (\n                <div\n                  key={request._id.toString()}\n                  className=\"bg-gray-800 rounded-lg shadow-xl p-6\"\n                >\n                  <div className=\"text-lg font-semibold text-white\">\n                    Teacher: {request.teacher.name} ({request.teacher.student_id})\n                  </div>\n                  <p className=\"text-sm text-gray-400 mt-2\">{request.description}</p>\n                  <p className=\"text-sm text-gray-500 mt-2\">\n                    Phone Number: <span className=\"font-semibold text-white\">{request.phoneNumber}</span>\n                  </p>\n\n                  {request.attachments.length > 0 && (\n                    <div className=\"mt-4\">\n                      <h3 className=\"text-sm text-gray-300 font-semibold\">Attachments:</h3>\n                      <ul className=\"list-disc list-inside mt-2 space-y-1\">\n                        {request.attachments.map((attachment, index) => (\n                          <li key={index}>\n                            <a\n                              href={attachment}\n                              target=\"_blank\"\n                              rel=\"noopener noreferrer\"\n                              className=\"text-blue-500 hover:underline\"\n                            >\n                              {attachment}\n                            </a>\n                          </li>\n                        ))}\n                      </ul>\n                    </div>\n                  )}\n\n                  {/* Teacher Details */}\n                  <div className=\"mt-6\">\n                    <h4 className=\"text-sm text-gray-300 font-semibold\">Teacher Details:</h4>\n                    <p className=\"text-sm text-gray-500 mt-2\">\n                      Branch: <span className=\"font-semibold text-white\">{request.teacher.branch}</span>\n                    </p>\n                    <p className=\"text-sm text-gray-500 mt-2\">\n                      Semester: <span className=\"font-semibold text-white\">{request.teacher.semester}</span>\n                    </p>\n                    {request.teacher.subjectMarks.map((subjectMark, index) => (\n                      <div key={index} className=\"mt-2\">\n                        <h5 className=\"text-sm text-gray-300 font-semibold\">\n                          Subject ID: {subjectMark.subjectId}\n                        </h5>\n                        <ul className=\"list-disc list-inside mt-2 space-y-1\">\n                          {subjectMark.allMarks.map((mark, i) => (\n                            <li key={i} className=\"text-sm text-gray-400\">\n                              {mark.examType}: {mark.marks} marks\n                            </li>\n                          ))}\n                        </ul>\n                      </div>\n                    ))}\n                  </div>\n\n                  {/* Action Buttons */}\n                  <div className=\"mt-6 flex justify-end space-x-4\">\n                    <button\n                      className=\"bg-green-600 hover:bg-green-700 text-white py-2 px-6 rounded-lg font-semibold shadow-lg transition-all duration-300\"\n                      onClick={() => setAcceptPopup({ visible: true, requestId: request._id.toString(), phoneNumber: \"\" })}                    >\n                      Accept\n                    </button>\n                    <button\n                      className=\"bg-red-600 hover:bg-red-700 text-white py-2 px-6 rounded-lg font-semibold shadow-lg transition-all duration-300\"\n                      onClick={() => setRejectPopup({ visible: true, requestId: request._id.toString() })}\n                    >\n                      Reject\n                    </button>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Reject Popup */}\n      {rejectPopup.visible && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50\">\n          <div className=\"bg-gray-900 p-6 rounded-lg shadow-xl w-full max-w-md\">\n            <h2 className=\"text-xl font-bold text-red-500 text-center\">Confirm Rejection</h2>\n            <p className=\"text-gray-300 text-center mt-4\">\n              Are you sure you want to reject this request?\n            </p>\n            <div className=\"flex justify-end mt-6 space-x-4\">\n              <button\n                className=\"bg-gray-600 hover:bg-gray-700 text-white py-2 px-6 rounded-lg font-semibold shadow-lg transition-all duration-300\"\n                onClick={() => setRejectPopup({ visible: false, requestId: null })}\n              >\n                Cancel\n              </button>\n              <button\n                className=\"bg-red-600 hover:bg-red-700 text-white py-2 px-6 rounded-lg font-semibold shadow-lg transition-all duration-300\"\n                onClick={handleReject}\n              >\n                Reject\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Accept Popup */}\n      {acceptPopup.visible && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50\">\n          <div className=\"bg-gray-900 p-6 rounded-lg shadow-xl w-full max-w-md\">\n            <h2 className=\"text-xl font-bold text-green-500 text-center\">Confirm Acceptance</h2>\n            <p className=\"text-gray-300 text-center mt-4\">\n              Please provide the phone number for confirmation.\n            </p>\n            <input\n              type=\"text\"\n              className=\"mt-4 w-full px-4 py-2 text-black rounded-md\"\n              placeholder=\"Enter phone number\"\n              value={acceptPopup.phoneNumber}\n              onChange={(e) =>\n                setAcceptPopup({ ...acceptPopup, phoneNumber: e.target.value })\n              }\n            />\n            <div className=\"flex justify-end mt-6 space-x-4\">\n              <button\n                className=\"bg-gray-600 hover:bg-gray-700 text-white py-2 px-6 rounded-lg font-semibold shadow-lg transition-all duration-300\"\n                onClick={() => setAcceptPopup({ visible: false, requestId: null, phoneNumber: \"\" })}\n              >\n                Cancel\n              </button>\n              <button\n                className=\"bg-green-600 hover:bg-green-700 text-white py-2 px-6 rounded-lg font-semibold shadow-lg transition-all duration-300\"\n                onClick={handleAccept}\n              >\n                Accept\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/study-requests/[...studyRequestId]/page.tsx b/app/study-requests/[...studyRequestId]/page.tsx
--- a/app/study-requests/[...studyRequestId]/page.tsx	(revision 1161b7fa87167907ba1c58af589d8f25fed94db9)
+++ b/app/study-requests/[...studyRequestId]/page.tsx	(date 1736842279756)
@@ -60,11 +60,6 @@
     } finally {
       setLoading(false);
     }
-
-    // const res = await axios.get("/api/health");
-    // if (res.status === 200) {
-    //   alert("Accepted request successfully");
-    // }
   };
 
   const handleReject = async () => {
@@ -97,6 +92,8 @@
     return <DotsLoader />;
   }
 
+  console.log(singleRequest);
+
   return (
     <div className="min-h-screen bg-gradient-to-b from-gray-900 via-gray-800 to-black text-white">
       {/* Page Header */}
Index: .idea/workspace.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project version=\"4\">\n  <component name=\"AutoImportSettings\">\n    <option name=\"autoReloadType\" value=\"SELECTIVE\" />\n  </component>\n  <component name=\"ChangeListManager\">\n    <list default=\"true\" id=\"3d45d623-ee8a-421e-8d0d-07f88c3fd10c\" name=\"Changes\" comment=\"fixup! recovered files\">\n      <change beforePath=\"$PROJECT_DIR$/.idea/workspace.xml\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/.idea/workspace.xml\" afterDir=\"false\" />\n      <change beforePath=\"$PROJECT_DIR$/app/api/(auth)/verify-sid/route.ts\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/app/api/(auth)/verify-sid/route.ts\" afterDir=\"false\" />\n      <change beforePath=\"$PROJECT_DIR$/app/events/[...eventId]/page.tsx\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/app/events/[...eventId]/page.tsx\" afterDir=\"false\" />\n      <change beforePath=\"$PROJECT_DIR$/app/events/add-event/page.tsx\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/app/events/add-event/page.tsx\" afterDir=\"false\" />\n      <change beforePath=\"$PROJECT_DIR$/app/home/page.tsx\" beforeDir=\"false\" />\n    </list>\n    <option name=\"SHOW_DIALOG\" value=\"false\" />\n    <option name=\"HIGHLIGHT_CONFLICTS\" value=\"true\" />\n    <option name=\"HIGHLIGHT_NON_ACTIVE_CHANGELIST\" value=\"false\" />\n    <option name=\"LAST_RESOLUTION\" value=\"IGNORE\" />\n  </component>\n  <component name=\"FileTemplateManagerImpl\">\n    <option name=\"RECENT_TEMPLATES\">\n      <list>\n        <option value=\"tsconfig.json\" />\n        <option value=\"TypeScript JSX File\" />\n        <option value=\"TypeScript File\" />\n      </list>\n    </option>\n  </component>\n  <component name=\"Git.Settings\">\n    <option name=\"RECENT_BRANCH_BY_REPOSITORY\">\n      <map>\n        <entry key=\"$PROJECT_DIR$\" value=\"css-testing\" />\n      </map>\n    </option>\n    <option name=\"RECENT_GIT_ROOT_PATH\" value=\"$PROJECT_DIR$\" />\n    <option name=\"RESET_MODE\" value=\"MIXED\" />\n  </component>\n  <component name=\"GitHubPullRequestSearchHistory\">{\n  &quot;lastFilter&quot;: {\n    &quot;state&quot;: &quot;OPEN&quot;,\n    &quot;assignee&quot;: &quot;VaibhavVerma27&quot;\n  }\n}</component>\n  <component name=\"GithubPullRequestsUISettings\">{\n  &quot;selectedUrlAndAccountId&quot;: {\n    &quot;url&quot;: &quot;https://github.com/VaibhavVerma27/Ideathon.git&quot;,\n    &quot;accountId&quot;: &quot;2d85c29d-bd34-4650-83c7-ed5abaf2838e&quot;\n  }\n}</component>\n  <component name=\"ProblemsViewState\">\n    <option name=\"selectedTabId\" value=\"CurrentFile\" />\n  </component>\n  <component name=\"ProjectColorInfo\">{\n  &quot;associatedIndex&quot;: 5\n}</component>\n  <component name=\"ProjectId\" id=\"2pwcVN5jNvv3r7ErnbxxbDHxjE8\" />\n  <component name=\"ProjectViewState\">\n    <option name=\"hideEmptyMiddlePackages\" value=\"true\" />\n    <option name=\"showLibraryContents\" value=\"true\" />\n  </component>\n  <component name=\"PropertiesComponent\">{\n  &quot;keyToString&quot;: {\n    &quot;RunOnceActivity.ShowReadmeOnStart&quot;: &quot;true&quot;,\n    &quot;RunOnceActivity.git.unshallow&quot;: &quot;true&quot;,\n    &quot;git-widget-placeholder&quot;: &quot;main&quot;,\n    &quot;last_opened_file_path&quot;: &quot;/home/vaibhav-verma/WebstormProjects/ideathon/app/api/teacher/announcements&quot;,\n    &quot;node.js.detected.package.eslint&quot;: &quot;true&quot;,\n    &quot;node.js.detected.package.tslint&quot;: &quot;true&quot;,\n    &quot;node.js.selected.package.eslint&quot;: &quot;(autodetect)&quot;,\n    &quot;node.js.selected.package.tslint&quot;: &quot;(autodetect)&quot;,\n    &quot;nodejs_package_manager_path&quot;: &quot;npm&quot;,\n    &quot;ts.external.directory.path&quot;: &quot;/home/vaibhav-verma/WebstormProjects/ideathon/node_modules/typescript/lib&quot;,\n    &quot;vue.rearranger.settings.migration&quot;: &quot;true&quot;\n  }\n}</component>\n  <component name=\"RecentsManager\">\n    <key name=\"CopyFile.RECENT_KEYS\">\n      <recent name=\"$PROJECT_DIR$/app/api/teacher/announcements\" />\n      <recent name=\"$PROJECT_DIR$/app/api/admin/user\" />\n    </key>\n    <key name=\"MoveFile.RECENT_KEYS\">\n      <recent name=\"$PROJECT_DIR$/app/admin\" />\n      <recent name=\"$PROJECT_DIR$/app/teacher/announcements/edit/[...id]\" />\n      <recent name=\"$PROJECT_DIR$/app/api/user\" />\n      <recent name=\"$PROJECT_DIR$/app/api/study-requests/accepted-requests/[...acceptedStudyRequestId]\" />\n      <recent name=\"$PROJECT_DIR$/app/api/study-requests/my-requests\" />\n    </key>\n  </component>\n  <component name=\"SharedIndexes\">\n    <attachedChunks>\n      <set>\n        <option value=\"bundled-js-predefined-d6986cc7102b-deb605915726-JavaScript-WS-243.22562.222\" />\n      </set>\n    </attachedChunks>\n  </component>\n  <component name=\"SpellCheckerSettings\" RuntimeDictionaries=\"0\" Folders=\"0\" CustomDictionaries=\"0\" DefaultDictionary=\"application-level\" UseSingleDictionary=\"true\" transferred=\"true\" />\n  <component name=\"TaskManager\">\n    <task active=\"true\" id=\"Default\" summary=\"Default task\">\n      <changelist id=\"3d45d623-ee8a-421e-8d0d-07f88c3fd10c\" name=\"Changes\" comment=\"\" />\n      <created>1733680600234</created>\n      <option name=\"number\" value=\"Default\" />\n      <option name=\"presentableId\" value=\"Default\" />\n      <updated>1733680600234</updated>\n      <workItem from=\"1733680601320\" duration=\"285000\" />\n      <workItem from=\"1733724675594\" duration=\"611000\" />\n      <workItem from=\"1733822080765\" duration=\"1111000\" />\n      <workItem from=\"1733835011657\" duration=\"6379000\" />\n      <workItem from=\"1733847978381\" duration=\"5516000\" />\n      <workItem from=\"1733894701134\" duration=\"9865000\" />\n      <workItem from=\"1733925499497\" duration=\"1606000\" />\n      <workItem from=\"1733928369051\" duration=\"251000\" />\n      <workItem from=\"1733928630064\" duration=\"4368000\" />\n      <workItem from=\"1733980473805\" duration=\"1457000\" />\n      <workItem from=\"1734070775491\" duration=\"813000\" />\n      <workItem from=\"1734085817459\" duration=\"30000\" />\n      <workItem from=\"1734183280596\" duration=\"5230000\" />\n      <workItem from=\"1734189002399\" duration=\"3292000\" />\n      <workItem from=\"1734192305926\" duration=\"2303000\" />\n      <workItem from=\"1734194762220\" duration=\"86000\" />\n      <workItem from=\"1734199075722\" duration=\"1951000\" />\n      <workItem from=\"1734202864084\" duration=\"690000\" />\n      <workItem from=\"1734243660946\" duration=\"163000\" />\n      <workItem from=\"1734247462466\" duration=\"601000\" />\n      <workItem from=\"1734274484596\" duration=\"221000\" />\n      <workItem from=\"1734285025230\" duration=\"756000\" />\n      <workItem from=\"1734342119399\" duration=\"12152000\" />\n      <workItem from=\"1734415130463\" duration=\"154000\" />\n      <workItem from=\"1734451510425\" duration=\"1022000\" />\n      <workItem from=\"1734515159954\" duration=\"1302000\" />\n      <workItem from=\"1734587553335\" duration=\"2223000\" />\n      <workItem from=\"1734622604490\" duration=\"6450000\" />\n      <workItem from=\"1734672636682\" duration=\"3862000\" />\n      <workItem from=\"1734697995805\" duration=\"4210000\" />\n      <workItem from=\"1734709695437\" duration=\"1288000\" />\n      <workItem from=\"1734719253317\" duration=\"6275000\" />\n      <workItem from=\"1734766424331\" duration=\"15352000\" />\n      <workItem from=\"1734859762039\" duration=\"16109000\" />\n      <workItem from=\"1734888157235\" duration=\"1752000\" />\n      <workItem from=\"1734936981008\" duration=\"20081000\" />\n      <workItem from=\"1735026512179\" duration=\"9324000\" />\n      <workItem from=\"1735048088338\" duration=\"5248000\" />\n      <workItem from=\"1735060156138\" duration=\"2618000\" />\n      <workItem from=\"1735064720771\" duration=\"656000\" />\n      <workItem from=\"1735106418820\" duration=\"148000\" />\n      <workItem from=\"1735141420059\" duration=\"11523000\" />\n      <workItem from=\"1735194562583\" duration=\"6771000\" />\n      <workItem from=\"1735224189800\" duration=\"10335000\" />\n      <workItem from=\"1735280126356\" duration=\"8507000\" />\n      <workItem from=\"1735312870855\" duration=\"4460000\" />\n      <workItem from=\"1735327415197\" duration=\"5118000\" />\n      <workItem from=\"1735368401501\" duration=\"8272000\" />\n      <workItem from=\"1735394000412\" duration=\"72000\" />\n      <workItem from=\"1735395983128\" duration=\"5172000\" />\n      <workItem from=\"1735411913079\" duration=\"275000\" />\n      <workItem from=\"1735412199180\" duration=\"4549000\" />\n      <workItem from=\"1735456473928\" duration=\"2596000\" />\n      <workItem from=\"1735473072434\" duration=\"168000\" />\n      <workItem from=\"1735476153656\" duration=\"3525000\" />\n      <workItem from=\"1735481667323\" duration=\"351000\" />\n      <workItem from=\"1735490418912\" duration=\"13947000\" />\n      <workItem from=\"1735551425427\" duration=\"1037000\" />\n      <workItem from=\"1735573605003\" duration=\"15386000\" />\n      <workItem from=\"1735630632922\" duration=\"3068000\" />\n      <workItem from=\"1735646800736\" duration=\"2798000\" />\n      <workItem from=\"1735662088128\" duration=\"1184000\" />\n      <workItem from=\"1735671274748\" duration=\"238000\" />\n      <workItem from=\"1735719997150\" duration=\"3868000\" />\n      <workItem from=\"1735738596357\" duration=\"21727000\" />\n      <workItem from=\"1735803780445\" duration=\"3957000\" />\n      <workItem from=\"1735834776101\" duration=\"1436000\" />\n      <workItem from=\"1735887939114\" duration=\"9151000\" />\n      <workItem from=\"1735912253570\" duration=\"2503000\" />\n      <workItem from=\"1735936579519\" duration=\"4282000\" />\n      <workItem from=\"1735976191219\" duration=\"1696000\" />\n      <workItem from=\"1735985050166\" duration=\"4726000\" />\n      <workItem from=\"1736003028073\" duration=\"54000\" />\n      <workItem from=\"1736005381956\" duration=\"622000\" />\n      <workItem from=\"1736015697437\" duration=\"8495000\" />\n      <workItem from=\"1736059367137\" duration=\"10380000\" />\n      <workItem from=\"1736164657551\" duration=\"6350000\" />\n      <workItem from=\"1736182719895\" duration=\"1744000\" />\n      <workItem from=\"1736235191519\" duration=\"1089000\" />\n      <workItem from=\"1736266445785\" duration=\"30000\" />\n      <workItem from=\"1736322350336\" duration=\"2281000\" />\n      <workItem from=\"1736334930878\" duration=\"1509000\" />\n      <workItem from=\"1736346401880\" duration=\"13674000\" />\n      <workItem from=\"1736404657076\" duration=\"6005000\" />\n      <workItem from=\"1736424912533\" duration=\"12432000\" />\n      <workItem from=\"1736494266531\" duration=\"2126000\" />\n      <workItem from=\"1736578088376\" duration=\"1169000\" />\n      <workItem from=\"1736580717395\" duration=\"8639000\" />\n      <workItem from=\"1736609464635\" duration=\"10431000\" />\n      <workItem from=\"1736661826883\" duration=\"29277000\" />\n      <workItem from=\"1736745014949\" duration=\"1257000\" />\n      <workItem from=\"1736750325263\" duration=\"1628000\" />\n      <workItem from=\"1736764910004\" duration=\"3159000\" />\n      <workItem from=\"1736779876545\" duration=\"17843000\" />\n      <workItem from=\"1736827225342\" duration=\"2213000\" />\n    </task>\n    <servers />\n  </component>\n  <component name=\"TypeScriptGeneratedFilesManager\">\n    <option name=\"version\" value=\"3\" />\n    <option name=\"exactExcludedFiles\">\n      <list>\n        <option value=\"$PROJECT_DIR$/next.config.mjs\" />\n      </list>\n    </option>\n  </component>\n  <component name=\"Vcs.Log.Tabs.Properties\">\n    <option name=\"OPEN_GENERIC_TABS\">\n      <map>\n        <entry key=\"6a35ed3b-0ed1-49df-9598-09b527d43acf\" value=\"TOOL_WINDOW\" />\n      </map>\n    </option>\n    <option name=\"TAB_STATES\">\n      <map>\n        <entry key=\"6a35ed3b-0ed1-49df-9598-09b527d43acf\">\n          <value>\n            <State />\n          </value>\n        </entry>\n        <entry key=\"MAIN\">\n          <value>\n            <State>\n              <option name=\"FILTERS\">\n                <map>\n                  <entry key=\"branch\">\n                    <value>\n                      <list>\n                        <option value=\"main\" />\n                      </list>\n                    </value>\n                  </entry>\n                </map>\n              </option>\n            </State>\n          </value>\n        </entry>\n      </map>\n    </option>\n  </component>\n  <component name=\"VcsManagerConfiguration\">\n    <MESSAGE value=\"fixup! recovered files\" />\n    <option name=\"LAST_COMMIT_MESSAGE\" value=\"fixup! recovered files\" />\n  </component>\n</project>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/.idea/workspace.xml b/.idea/workspace.xml
--- a/.idea/workspace.xml	(revision 1161b7fa87167907ba1c58af589d8f25fed94db9)
+++ b/.idea/workspace.xml	(date 1736843427791)
@@ -7,9 +7,7 @@
     <list default="true" id="3d45d623-ee8a-421e-8d0d-07f88c3fd10c" name="Changes" comment="fixup! recovered files">
       <change beforePath="$PROJECT_DIR$/.idea/workspace.xml" beforeDir="false" afterPath="$PROJECT_DIR$/.idea/workspace.xml" afterDir="false" />
       <change beforePath="$PROJECT_DIR$/app/api/(auth)/verify-sid/route.ts" beforeDir="false" afterPath="$PROJECT_DIR$/app/api/(auth)/verify-sid/route.ts" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/app/events/[...eventId]/page.tsx" beforeDir="false" afterPath="$PROJECT_DIR$/app/events/[...eventId]/page.tsx" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/app/events/add-event/page.tsx" beforeDir="false" afterPath="$PROJECT_DIR$/app/events/add-event/page.tsx" afterDir="false" />
-      <change beforePath="$PROJECT_DIR$/app/home/page.tsx" beforeDir="false" />
+      <change beforePath="$PROJECT_DIR$/app/study-requests/[...studyRequestId]/page.tsx" beforeDir="false" afterPath="$PROJECT_DIR$/app/study-requests/[...studyRequestId]/page.tsx" afterDir="false" />
     </list>
     <option name="SHOW_DIALOG" value="false" />
     <option name="HIGHLIGHT_CONFLICTS" value="true" />
@@ -195,6 +193,7 @@
       <workItem from="1736764910004" duration="3159000" />
       <workItem from="1736779876545" duration="17843000" />
       <workItem from="1736827225342" duration="2213000" />
+      <workItem from="1736841852981" duration="1575000" />
     </task>
     <servers />
   </component>
Index: app/api/(auth)/verify-sid/route.ts
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>import { NextRequest, NextResponse } from \"next/server\";\nimport  extractTextFromImageLinks, { extractDetails } from \"../../../../lib/sidVerification\";\nimport {ClubModel, StudentModel, UserModel} from \"../../../../model/User\";\nimport dbConnect from \"../../../../lib/connectDb\";\nimport Groq from 'groq-sdk';\n\nconst groqClient = new Groq({\n  apiKey: process.env.GROQ_API_KEY,\n});\n\n\nconst extractNameFromEmail = (email: string | undefined): string | null => {\n  if (!email || typeof email !== 'string') {\n    return null;\n  }\n\n  const match = email.match(/^([a-zA-Z]+)\\.bt\\d+([a-z]+)@pec\\.edu\\.in$/);\n  return match ? match[1] : null;\n};\n\n\ninterface AiNameCheckerResponse {\n  choices: {\n    message: {\n      content: string | null;\n    };\n  }[];\n}\n\nconst correctNamefromEmail = async (email: string | undefined): Promise<string | null> => {\n  const prompt = `I am going to give you an email, from that email you have to return me the name of the person. The email is in the format: name.btxxxxx@pec.edu.in. So for example for an email antrikshgupta.bt23cseds@pec.edu.in, you have the return me the name as Antriksh Gupta. and send no other text, just the name in correct format, ${email}`\n  const completion = await groqClient.chat.completions.create({\n    messages: [{role:\"user\",content: prompt}],\n    model: 'llama3-70b-8192'\n  });\n  return completion.choices[0]?.message?.content;\n}\n\nconst aiNameChecker = async (emailName: string, name: string): Promise<boolean> => {\n  const prompt = `I am going to give you two string, you have to tell me if they are same or not. \\n\\nString 1: ${emailName} \\nString 2: ${name} \\n\\nAre these strings same? They dont have to be exactly equal. String like antriikshguppta and Antriksh Gupta are considered Same. One of the strings is coming from an OCR, so its expected to have some mistakes in reading. Your work is to overlook these mistakes and tell me by your thinking whether they are same names or not.\\n\\nPlease type yes or no and dont type any other text. just yes or no.`;\n\n  const completion: AiNameCheckerResponse = await groqClient.chat.completions.create({\n    messages: [{ role: 'user', content: prompt }],\n    model: 'llama3-8b-8192',\n  });\n\n  const result = completion.choices[0]?.message?.content;\n  return result === 'yes';\n}\n\n// route.ts\nexport async function POST(request: NextRequest) {\n  console.log(\"Processing SID verification request\");\n\n  await dbConnect();\n\n  try {\n    const { username, image } = await request.json();\n\n    // Fix 1: Better input validation\n    if (!username || typeof username !== 'string' || !image || typeof image !== 'string') {\n      return NextResponse.json(\n        { success: false, message: 'Invalid username or image data' },\n        { status: 400 }\n      );\n    }\n\n    // Fix 2: Parallel database queries\n    const [user, student] = await Promise.all([\n      UserModel.findOne({ username: username }),\n      StudentModel.findOne({ name: username })\n    ]);\n\n    // Fix 3: Better error handling for missing records\n    if (!student || !user) {\n      console.log(\"User or student record not found:\", { user: !!user, student: !!student });\n      return NextResponse.json(\n        { success: false, message: 'User or student record not found' },\n        { status: 404 }\n      );\n    }\n\n    if (student.sid_verification) {\n      return NextResponse.json(\n        { success: false, message: 'SID verification already completed' },\n        { status: 400 }\n      );\n    }\n\n    // Fix 4: Image processing with proper error handling\n    const imageLinks = [image];\n    const results = await extractTextFromImageLinks(imageLinks);\n    \n    if (!results[image]) {\n      user.sid_verification = false;\n      await user.save();\n      return NextResponse.json(\n        { success: false, message: 'Failed to extract text from image' },\n        { status: 500 }\n      );\n    }\n\n    // Fix 5: Extract and validate details\n    const { name, department, identityNo } = await extractDetails(results[image]);\n    \n    if (!name || !department || !identityNo) {\n      console.log(\"Failed to extract required details:\", { name, department, identityNo });\n      user.sid_verification = false;\n      await user.save();\n      return NextResponse.json(\n        { success: false, message: 'Failed to extract required details from image' },\n        { status: 400 }\n      );\n    }\n\n    // Fix 6: More robust email name extraction and comparison\n    const emailName = extractNameFromEmail(student.email as string);\n    if (!emailName) {\n      return NextResponse.json(\n        { success: false, message: 'Invalid email format' },\n        { status: 400 }\n      );\n    }\n\n    // Fix 7: Name verification with better error handling\n    try {\n      const namesMatch = await aiNameChecker(emailName, name);\n      if (!namesMatch) {\n        user.sid_verification = false;\n        await user.save();\n        return NextResponse.json(\n          { success: false, message: 'Name mismatch between email and extracted text' },\n          { status: 400 }\n        );\n      }\n    } catch (error) {\n      console.error('Error in name verification:', error);\n      return NextResponse.json(\n        { success: false, message: 'Error during name verification' },\n        { status: 500 }\n      );\n    }\n\n    // Fix 8: Transaction-like updates\n    try {\n      const correctedName = await correctNamefromEmail(student.email);\n      student.name = correctedName ?? name;\n      student.sid_verification = true;\n      student.branch = department;\n      student.student_id = identityNo;\n      user.sid_verification = true;\n\n      await Promise.all([\n        student.save(),\n        user.save()\n      ]);\n\n\n      const clubsMemberOf = await ClubModel.aggregate([\n        {\n          $match: {\n            clubMembers:\n          }\n        }\n      ])\n\n      return NextResponse.json({\n        success: true,\n        message: 'SID verification completed',\n        data: { name, department, identityNo },\n      });\n    } catch (error) {\n      console.error('Error saving updates:', error);\n      return NextResponse.json(\n        { success: false, message: 'Error saving verification data' },\n        { status: 500 }\n      );\n    }\n\n  } catch (error) {\n    console.error('Error verifying user:', error);\n    return NextResponse.json(\n      { success: false, message: 'Internal server error during verification' },\n      { status: 500 }\n    );\n  }\n}
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/api/(auth)/verify-sid/route.ts b/app/api/(auth)/verify-sid/route.ts
--- a/app/api/(auth)/verify-sid/route.ts	(revision 1161b7fa87167907ba1c58af589d8f25fed94db9)
+++ b/app/api/(auth)/verify-sid/route.ts	(date 1736841890839)
@@ -159,7 +159,7 @@
       const clubsMemberOf = await ClubModel.aggregate([
         {
           $match: {
-            clubMembers:
+            clubMembers: identityNo
           }
         }
       ])
